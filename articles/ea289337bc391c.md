---
title: "react-hooks/exhaustive-depsç„¡è¦–ã—ã¦ãªã„ï¼Ÿ"
emoji: "ğŸ£"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["react", "js"]
published: true
---

## åˆã‚ã«

useEffect ã‚’ç”¨ã„ã¦ã€ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã¨åŒæœŸçš„ã«é–¢æ•°ã‚’å®Ÿè¡Œã•ã›ãŸã„æ™‚ã«ã€ä¾å­˜é–¢ä¿‚ã‚’ç¬¬äºŒå¼•æ•°ã«å…¥ã‚Œãªã„ã¨ linter ãŒã‚¨ãƒ©ãƒ¼ã‚’åãå‡ºã—ã¾ã™ã€‚

@[codesandbox](https://codesandbox.io/embed/infallible-almeida-zq19dd?fontsize=14&hidenavigation=1&theme=dark)

ã—ã‹ã—ã€ã‚¢ãƒ—ãƒªã®å‹•ä½œã«å•é¡ŒãŒãªã„å ´åˆã¯ã€ä¸‹è¨˜ã®ã‚ˆã†ã«ã—ã¦ lint ã‚’ç„¡è¦–ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã—ã¾ã£ãŸã“ã¨ã¯ã‚ã‚‹ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ï¼Ÿ
åŸºæœ¬çš„ã«ã€ãƒªãƒ³ã‚¿ãƒ¼ã¯ç„¡è¦–ã›ãšã«ã€å¾“ã†ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†

```jsx
useEffect(() => {
  // ...
  // ğŸ”´ Avoid suppressing the linter like this:
  // eslint-ignore-next-line react-hooks/exhaustive-deps
}, []);
```

https://react.dev/learn/removing-effect-dependencies#why-is-suppressing-the-dependency-linter-so-dangerous

ã§ã¯ã€ã©ã®ã‚ˆã†ã« lint ã®ã‚¨ãƒ©ãƒ¼ã®è§£æ¶ˆã‚’è¡Œãªã£ã¦ã„ã‘ã°ã‚ˆã„ã§ã—ã‚‡ã†ã‹ï¼Ÿ
ä»¥ä¸‹ã®è³ªå•ã«ç­”ãˆã¦ã¿ã¦è§£æ±ºç­–ã‚’æ¢ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

## ãã‚‚ãã‚‚ useEffect ä½¿ã‚ãªã„ã¨ã ã‚ï¼Ÿ

æœ€åˆã«è€ƒãˆã‚‹ã¹ãã“ã¨ã¯ã€ã“ã®ã‚³ãƒ¼ãƒ‰ãŒ useEffect ã§ã‚ã‚‹ã¹ãã‹ã©ã†ã‹ã§ã™ã€‚
ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã§ã‚‚ã„ã„ã®ã§ã¯ãªã„ã‹ï¼Ÿã¨ã„ã†ã“ã¨ã‚’æ¤œè¨ã—ã¾ã—ã‚‡ã†ã€‚
Effect ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ“ä½œã¨ã¯é–¢ä¿‚ãªã„ç®‡æ‰€ã§èµ·ã“ã‚‹ã“ã¨ã§ã™ã®ã§ã€ãƒ•ã‚©ãƒ¼ãƒ ã‚’é€ä¿¡ã—ãŸæ™‚ãªã©ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã§ã¯ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’ä½¿ã†ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚

## useEffect å†…ã§ç„¡é–¢ä¿‚ãªã“ã¨ã‚’ã—ã¦ã„ãªã„ã‹ï¼Ÿ

ç„¡é–¢ä¿‚ãªãƒ­ã‚¸ãƒƒã‚¯ã‚’ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã«è¿½åŠ ã—ãªã„ã§ãã ã•ã„ã€‚
ã‚³ãƒ¼ãƒ‰å†…ã®å„åŠ¹æœã¯ã€åˆ¥å€‹ã®ç‹¬ç«‹ã—ãŸåŒæœŸãƒ—ãƒ­ã‚»ã‚¹ã‚’è¡¨ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```jsx
function ChatRoom({ roomId }) {
  useEffect(() => {
    logVisit(roomId);
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => {
      connection.disconnect();
    };
  }, [roomId]);
  // ...
}
```

ãŸã¨ãˆã°ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒéƒ¨å±‹ã‚’è¨ªã‚ŒãŸã¨ãã«åˆ†æã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ä¿¡ã™ã‚‹ã¨ã—ã¾ã™ã€‚ roomId ã«ä¾å­˜ã™ã‚‹ useEffect ãŒæ—¢ã«ã‚ã‚‹ã®ã§ã€ãã“ã«åˆ†æå‘¼ã³å‡ºã—ã‚’è¿½åŠ ã—ãŸããªã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
ã—ã‹ã—ã€å¾Œã§æ¥ç¶šã‚’å†ç¢ºç«‹ã™ã‚‹å¿…è¦ãŒã‚ã‚‹åˆ¥ã®ä¾å­˜é–¢ä¿‚ã‚’ã“ã® Effect ã«è¿½åŠ ã™ã‚‹ã“ã¨ã‚’æƒ³åƒã—ã¦ãã ã•ã„ã€‚ãã®æ™‚ã«ã€logVisit é–¢æ•°ã‚‚ç„¡é–¢ä¿‚ã§ã™ãŒã€å‘¼ã³å‡ºã•ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚
è¨ªå•ã®è¨˜éŒ²ã¯ã€æ¥ç¶šã¨ã¯åˆ¥ã®ãƒ—ãƒ­ã‚»ã‚¹ã§ã™ã€‚ãã‚Œã‚‰ã‚’ 2 ã¤ã®å€‹åˆ¥ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã¨ã—ã¦è¨˜è¿°ã—ã¾ã™ã€‚

```jsx
function ChatRoom({ roomId }) {
  useEffect(() => {
    logVisit(roomId);
  }, [roomId]);

  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    // ...
  }, [roomId]);
  // ...
}
```

## çŠ¶æ…‹ã‚’è¨ˆç®—ã™ã‚‹ãŸã‚ã«çŠ¶æ…‹ã‚’èª­ã¿ã£å–ã£ã¦ã¯ã„ãªã„ã‹ï¼Ÿ

```jsx
function ChatRoom({ roomId }) {
  const [messages, setMessages] = useState([]);
  useEffect(() => {
    const connection = createConnection();
    connection.connect();
    connection.on('message', (receivedMessage) => {
      setMessages([...messages, receivedMessage]);
    });
    return () => connection.disconnect();
  }, [roomId, messages]); // âœ… All dependencies declared
  // ...
```

message ã‚’å—ã‘ã¨ã£ã¦æ–°ã—ã„é…åˆ—ã‚’ä½œã‚‹ãŸã‚ã«ã€message ã‚’èª­ã¿ã£ã¦è¨ˆç®—ã—ã¦ã„ã¾ã™ã€‚
ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡ã™ã‚‹ãŸã³ã«ã€ setMessages() ã«ã‚ˆã‚Šã€å—ä¿¡ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å«ã‚€æ–°ã—ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é…åˆ—ã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚
ãŸã ã—ã€ã“ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ä¾å­˜ã™ã‚‹ã‚ˆã†ã«ãªã£ãŸãŸã‚ã€ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚‚å†åŒæœŸã•ã‚Œã¾ã™ã€‚ãã®ãŸã‚ã€æ–°ã—ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚ã‚‹ãŸã³ã«ã€ãƒãƒ£ãƒƒãƒˆãŒå†æ¥ç¶šã•ã‚Œã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãã‚Œã‚’æœ›ã¾ãªã„ã§ã—ã‚‡ã†ï¼
ä¸‹è¨˜ã®ã‚ˆã†ãªå½¢ã§ã€message state ã‚’ä½¿ç”¨ã—ãªãã¦ã‚‚è¨˜è¿°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä¸ç”¨æ„ãª useEffect ã®å®Ÿè¡Œã‚’é˜²ãã“ã¨ãŒã§ãã¾ã™ã€‚

```jsx
function ChatRoom({ roomId }) {
  const [messages, setMessages] = useState([]);
  useEffect(() => {
    const connection = createConnection();
    connection.connect();
    connection.on('message', (receivedMessage) => {
      setMessages(msgs => [...msgs, receivedMessage]);
    });
    return () => connection.disconnect();
  }, [roomId]); // âœ… All dependencies declared
  // ...

```

## æœ€å¾Œã«

ä¸‹è¨˜ã§å‡¡ä¾‹ã‚’ç¤ºã—ã¦ãã‚Œã¦ã¾ã™ã€‚

https://react.dev/learn/removing-effect-dependencies#challenges
